<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For My Love ‚Äî Happy Birthday üíå</title>

<!-- Google font -->
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#fff6f8;
    --soft-pink: #ffdce6;
    --rose: #ff7aa6;
    --beige:#fff1ea;
    --text:#4b3a3f;
    --muted:#8b6f74;
    --card-shadow: 0 8px 30px rgba(75,58,63,0.08);
  }

  html,body{height:100%; margin:0; padding:0; background:
    radial-gradient(circle at 10% 10%, rgba(255,220,230,0.8) 0%, transparent 20%),
    radial-gradient(circle at 90% 90%, rgba(255,240,235,0.9) 0%, transparent 25%),
    var(--bg);
    font-family: "Quicksand", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:var(--text);
    -webkit-font-smoothing:antialiased;
  }

  /* page container */
  .wrap{
    max-width:980px;
    margin:24px auto;
    padding:20px;
  }

  header{
    display:flex;
    gap:16px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
    margin-bottom:8px;
  }

  .brand{
    display:flex;
    align-items:center;
    gap:12px;
  }
  .logo{
    width:56px;height:56px;border-radius:14px;
    background: linear-gradient(180deg,#fff7f9,#ffeef4);
    display:flex;align-items:center;justify-content:center;
    box-shadow: var(--card-shadow);
    font-size:26px;
  }

  h1{
    margin:0;font-family:"Playfair Display", serif;
    font-size:20px;color:var(--rose); letter-spacing:0.4px;
  }
  .sub {
    font-size:13px;color:var(--muted);
  }

  nav {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  padding: 10px 0;
}

.nav-btn {
  background: linear-gradient(180deg, #fff, #fff6f8);
  border: 1px solid rgba(255,122,166,0.25);
  padding: 9px 16px;
  border-radius: 999px;
  color: var(--rose);
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 6px 18px rgba(255,122,166,0.09);
  transition: .28s;
}

.nav-btn:hover {
  transform: scale(1.06);
  box-shadow: 0 10px 24px rgba(255,122,166,0.18);
  background: linear-gradient(180deg, #fff7fa, #ffeef4);
}

/* Phone layout fix */
@media(max-width: 600px){
  nav {
    overflow-x: auto;
    white-space: nowrap;
    padding-bottom: 6px;
    justify-content: flex-start;
    scrollbar-width: none;
  }
  nav::-webkit-scrollbar { display: none; }
  .nav-btn {
    flex: 0 0 auto;
  }
}


  /* hero card */
  .hero{
    margin-top:14px;
    background: linear-gradient(180deg, rgba(255,250,250,0.9), var(--beige));
    border-radius:18px;
    padding:18px;
    box-shadow: var(--card-shadow);
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:18px;
    align-items:center;
  }

  @media(max-width:880px){
    .hero{ grid-template-columns: 1fr; padding:16px; }
  }

  .hero-left{
    text-align:left; padding-left:6px;
  }
  .hero-left h2{
    margin:0; color:#a84b6a; font-family:"Playfair Display",serif; font-size:26px;
  }
  .hero-left p{ margin:8px 0 0; color:var(--muted); font-size:15px; line-height:1.5; }

  .hero-right{
    display:flex;flex-direction:column;align-items:center;gap:12px;
  }

  /* slideshow frame */
  .frame {
    width:100%;
    max-width:320px;
    border-radius:16px;
    overflow:hidden;
    background:linear-gradient(180deg,#fff,#fff8f9);
    box-shadow: 0 18px 40px rgba(86,44,60,0.08);
    border: 1px solid rgba(255,170,190,0.07);
    position:relative;
  }

  .frame img{
    width:100%; height:100%; object-fit:cover; display:block;
    aspect-ratio: 3/4;
  }

  .slide-dots{
    position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
    display:flex; gap:6px; z-index:10;
  }
  .dot { width:8px;height:8px;border-radius:50%; background:rgba(255,255,255,0.6); box-shadow:0 2px 6px rgba(0,0,0,0.15); opacity:.9;}
  .dot.active{ background:var(--rose); transform:scale(1.1); }

  /* main controls */
  .controls{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
  .primary{
    background: linear-gradient(90deg,var(--rose),#ff6f97);
    color:white; padding:10px 18px;border-radius:999px; border:none; font-weight:700; cursor:pointer;
    box-shadow: 0 12px 30px rgba(255,122,166,0.12);
  }
  .secondary{
    background:transparent;border:1px solid rgba(139,111,116,0.08);
    padding:9px 14px;border-radius:12px;color:var(--rose); cursor:pointer; font-weight:600;
  }

  /* small quote sticker */
  .sticker{
    margin-top:12px; display:inline-block; padding:10px 14px; border-radius:12px; background:linear-gradient(180deg,#fff,#fff6f8);
    border:1px dashed rgba(255,122,166,0.12); font-style:italic; color:var(--muted);
    box-shadow:0 6px 18px rgba(86,44,60,0.04);
  }

  /* sections */
  .section{
    margin-top:26px;
  }
  .section h3{ margin:0 0 12px 0; color:var(--rose); font-family:"Playfair Display",serif; }

  /* flip-card grid */
  .grid {
    display:grid; grid-template-columns: repeat(3,1fr); gap:14px;
  }
  @media(max-width:720px){ .grid{ grid-template-columns: repeat(2,1fr);} }
  @media(max-width:420px){ .grid{ grid-template-columns: 1fr;} }

  .flip {
    perspective:900px; width:100%; height:210px; position:relative;
  }
  .flip-inner{
    position:relative; width:100%; height:100%; transition: transform 0.9s cubic-bezier(.2,.9,.2,1);
    transform-style:preserve-3d;
    border-radius:14px; box-shadow: 0 14px 30px rgba(86,44,60,0.06);
    cursor:pointer;
  }
  .flip:hover .flip-inner{ transform: rotateY(180deg) translateZ(0); }

  .face{
    position:absolute; inset:0; backface-visibility:hidden; border-radius:14px; overflow:hidden;
  }
  .front{
    background:linear-gradient(180deg,#fff,#fff6f8);
    display:flex;align-items:center;justify-content:center;
  }
  .front img{ width:100%; height:100%; object-fit:cover; display:block; }

  .back{
    transform:rotateY(180deg);
    background: linear-gradient(180deg,#fff1f4,#fff7f9);
    display:flex;align-items:center;justify-content:center;padding:14px;
    color:var(--muted); font-size:15px; text-align:center;
  }

  /* letter parchment */
  .parchment {
    margin:14px auto; max-width:760px; background: linear-gradient(180deg,#fff8f6,#fff1ea);
    border-radius:14px; padding:18px; box-shadow: var(--card-shadow);
    border:1px solid rgba(255,200,215,0.4);
    font-family:"Georgia", serif; color:#534044; font-size:16px; line-height:1.6;
    display:none; transform-origin: top center;
  }

  .parchment.open{ display:block; animation: slideDown 0.9s cubic-bezier(.2,.9,.2,1); }
  @keyframes slideDown{ 0%{ transform: translateY(-20px) scale(.98); opacity:0 } 100%{ transform: translateY(0) scale(1); opacity:1 } }

  /* secret overlay / page */
  .overlay {
    position:fixed; inset:0; background: linear-gradient(180deg, rgba(21,7,10,0.4), rgba(255,240,245,0.6));
    display:none; align-items:center; justify-content:center; z-index:120;
  }
  .overlay.show{ display:flex; }

  .secret {
    width:min(820px,94%); max-height:90vh; overflow:auto; border-radius:16px; padding:20px;
    background: linear-gradient(180deg,#fff7fa,#fff1ef); box-shadow: 0 40px 80px rgba(86,44,60,0.12);
    border:1px solid rgba(255,180,200,0.4);
  }
  .secret h2{ margin-top:0; color:#b23d62; font-family:"Playfair Display",serif; }
  .secret p{ color:#6a4b52; line-height:1.6; }

  .closeX{ position:absolute; top:20px; right:20px; background:transparent;border:none;color:white;font-size:20px; cursor:pointer; }

  /* little decorative hearts (subtle) */
  .tiny-hearts{ position:fixed; right:18px; top:18px; display:flex; flex-direction:column; gap:6px; z-index:50; }
  .tiny-hearts div{ font-size:18px; transform:translateY(0); opacity:0.95; filter: drop-shadow(0 6px 14px rgba(170,70,110,0.08)); }

  /* footer */
  footer{ margin:40px 0 80px; text-align:center; color:var(--muted); font-size:13px; }


  /* ------------------ ADDED STYLES ------------------ */
  /* opening overlay */
  #openingOverlay{
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:5000;
    background: linear-gradient(180deg, rgba(255,245,247,0.98), rgba(255,240,245,0.95));
    backdrop-filter: blur(4px);
  }
  .opening-card{
    width:min(720px,92%); padding:28px; border-radius:18px; text-align:center;
    background:linear-gradient(180deg,#fff,#fff6f8); box-shadow:0 30px 80px rgba(86,44,60,0.12);
    border:1px solid rgba(255,200,215,0.4); transform:translateY(10px);
    animation:openingPop .9s cubic-bezier(.2,.9,.2,1);
  }
  @keyframes openingPop{ from{opacity:0; transform:translateY(20px) scale(.98)} to{opacity:1; transform:translateY(0) scale(1)}}
  .opening-card h2{font-family:"Playfair Display"; color:var(--rose); margin:0 0 10px 0;}
  .opening-card p{color:var(--muted); margin:0 0 18px 0;}

  /* voice modal */
  #voiceModal{
    position:fixed; right:20px; bottom:90px; width:320px; background:linear-gradient(180deg,#fff,#fff7fa);
    border-radius:12px; box-shadow:0 20px 60px rgba(86,44,60,0.12); padding:12px; z-index:4000; display:none;
  }
  #voiceModal h4{margin:0 0 8px 0;color:#9c4362;}
  .voice-controls{display:flex;gap:8px;align-items:center;justify-content:flex-start;margin-top:8px;}
  .voice-btn{background:var(--rose);border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700;}
  .voice-small{background:transparent;border:1px solid rgba(0,0,0,0.06);border-radius:8px;padding:6px 8px;cursor:pointer;}
  #voiceModal .closeLocal{ position:absolute; top:6px; right:8px; background:none; border:none; font-size:18px; cursor:pointer; color:#9c4362; }

  /* gift button */
  #giftBtn{ position:fixed; left:18px; bottom:20px; z-index:3000; background:linear-gradient(90deg,#ff9ccf,#ff6f97); color:white; border:none; padding:12px 16px; border-radius:999px; font-weight:700; box-shadow:0 12px 30px rgba(255,122,166,0.14); cursor:pointer;}
  /* gift reveal */
  #giftReveal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.45); z-index:4500;}
  #giftCard{ background:linear-gradient(180deg,#fff6f8,#fff1f1); padding:28px; border-radius:20px; text-align:center; box-shadow:0 60px 120px rgba(0,0,0,0.3); max-width:720px; width:90%;}
  #giftCard h2{font-family:"Playfair Display"; color:#b23d62; margin:0 0 8px 0;}
  .confetti-piece{ position:fixed; font-size:22px; pointer-events:none; z-index:4999; }
</style>
</head>
<body>

  <!-- =============== OPENING OVERLAY (NEW) =============== -->
  <div id="openingOverlay" aria-hidden="false">
    <div class="opening-card" role="dialog" aria-modal="true">
      <h2>Happy Birthday, Gaurav üéÇ</h2>
      <p>Open this little world I made for you ‚Äî soft, silly, and full of love. From your Khushi üíó</p>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:14px;">
        <button class="primary" onclick="enterSite()">Enter</button>
        <button class="secondary" onclick="openVoiceModal()">Play a Voice Preview</button>
      </div>
    </div>
  </div>

  <!-- =============== VOICE MODAL (NEW, IMPROVED) =============== -->
  <div id="voiceModal" aria-hidden="true" role="dialog">
    <button class="closeLocal" aria-label="Close voice" onclick="closeVoiceModal()">‚úï</button>
    <h4>Voice message ‚Äî Khushi ‚Üí Gaurav</h4>
    <div style="font-size:14px;color:var(--muted);">Preview via browser voice (or play your recorded file below).</div>

    <div class="voice-controls" style="margin-top:10px;">
      <button class="voice-btn" id="playTTS" onclick="playTTS()">Play (TTS)</button>
      <button class="voice-small" id="stopTTS" onclick="stopTTS()">Stop</button>
    </div>

    <div style="margin-top:12px; border-top:1px dashed rgba(200,150,170,0.08); padding-top:10px;">
      <div style="font-size:13px;color:var(--muted);margin-bottom:6px;"> My Recorded voice with love</div>
      <audio id="recordedAudio" controls style="width:100%;">
        <!-- Drop your recorded file named "voice-message.mp3" next to this html to use it -->
        <source id="recordedSrc" src="voice-message.mp3" type="audio/mpeg">
        Your browser does not support audio.
      </audio>
    </div>

    <div style="margin-top:10px; font-size:12px; color:var(--muted);">
        Love you so much my Baby, My Dumbo
      <!--Tip: record your voice, name the file <strong>voice-message.mp3</strong> and put it next to this HTML. Then reopen the modal and press play.-->
    </div>
  </div>

  <!-- =============== GIFT BUTTON (NEW) =============== -->
  <button id="giftBtn" onclick="openGift()">Tap to open your gift üéÅ</button>

  <!-- =============== GIFT REVEAL (NEW) =============== -->
  <div id="giftReveal" aria-hidden="true">
    <div id="giftCard" role="dialog" aria-modal="true">
      <h2>For Gaurav ‚Äî A Little Surprise</h2>
      <p style="color:var(--muted);">Open slowly, like a paper letter ‚Äî there's a small hidden message below.</p>
      <div style="margin-top:18px;">
        <button class="primary" onclick="finalReveal()">Open the Surprise üíó</button>
        <button class="secondary" style="margin-left:8px;" onclick="closeGift()">Close</button>
      </div>
      <div id="finalMessage" style="margin-top:18px; display:none;">
        <h3 style="margin:6px 0 8px 0;">Surprise ‚ù§Ô∏è</h3>
        <p style="color:var(--muted);">Gaurav - My Baby, you are my favourite person and my Soulmate, Happiest Birthday ‚Äî love, Your Khushi.</p>
      </div>
    </div>
  </div>

  <!-- =============== YOUR ORIGINAL PAGE (kept exactly) =============== -->
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">üíå</div>
        <div>
          <h1>For My Love ‚Äî Happy Birthday Dumbo</h1>
          <div class="sub">A small surprise made with a huge heart , My Babyüíó</div>
        </div>
      </div>

      <nav>
        <button class="nav-btn" onclick="goHome()">Home</button>
        <button class="nav-btn" onclick="scrollToSection('memories')">Memories</button>
        <button class="nav-btn" onclick="openLetter()">Open Letter</button>
        <button class="nav-btn" onclick="openSecret()">A Little Secret</button>
        <button class="nav-btn" onclick="openVoiceModal()">Voice Message üéß</button>
      </nav>
    </header>

    <!-- HERO   https://picsum.photos/480/640?random=11 -->
    <section class="hero" id="top">
      <div class="hero-left">
        <h2>To the one I love most</h2>
        <p>On 8th Nov ‚Äî I made this little pocket of memories & letters for you with so much love.  
           Soft, warm, and a bit playful ‚Äî like us Obviously. Click around, open secrets, and when you see a picture you like ‚Äî hover/tap the card to flip it. ‚ù§</p>

        <div class="controls">
          <button class="primary" onclick="specialMoment()">Click for a Surprise ‚ú®</button>
          <button class="secondary" onclick="openLetter()">Open the Letter üíå</button>
        </div>

        <div class="sticker">"You are my favorite hello and hardest goodbye, you are my home." ‚Äî small note</div>
      </div>

      <div class="hero-right">
        <div class="frame">
          <img id="mainSlide" src="images/him2.jpg" alt="slideshow">
          <div class="slide-dots" id="dots"></div>
        </div>

        <div style="font-size:13px;color:var(--muted);margin-top:8px">Tap the heart button or open the letter ‚Äî little things await üíï</div>
      </div>
    </section>

    <!-- MEMORIES -->
    <section class="section" id="memories">
      <h3>Memories & Polaroids</h3>

      <div class="grid" id="flipGrid">
        <!-- Nine flip cards (dummy images) -->
        <div class="flip" data-note="Our trip to jaipur ‚Äî Still remember your laugh.">
          <div class="flip-inner" onclick="openFlipNote(this)">
            <div class="face front"><img src="images/us11.jpg" alt="mem1"></div>
            <div class="face back">Our trip to jaipur ‚Äî Still remember your laugh and scooty rides.</div>
          </div>
        </div>

        <div class="flip" data-note="Rishikesh, singing (badly) together.">
          <div class="flip-inner" onclick="openFlipNote(this)">
            <div class="face front"><img src="images/us4.jpg" alt="mem2"></div>
            <div class="face back">Rishikesh,ghats,rafting,finding hotels, artis, walks, singing love songs(badly) together.</div>
          </div>
        </div>


        <div class="flip" data-note="Midnight movies and sharing popcorn.">
          <div class="flip-inner" onclick="openFlipNote(this)">
            <div class="face front"><img src="images/us10.jpg" alt="mem3"></div>
            <div class="face back">The first time we met i real life ‚Äî our first night together(Radissan) .</div>
          </div>
        </div>

        <div class="flip" data-note="Your goofy faces that make me melt.">
          <div class="flip-inner" onclick="openFlipNote(this)">
            <div class="face front"><img src="images/us8.jpg" alt="mem4"></div>
            <div class="face back">Your goofy faces that make me melt, the way my eyes always on you.</div>
          </div>
        </div>
         
        <div class="flip" data-note="Your first birthday with me ‚Äî best day ever.">
          <div class="flip-inner" onclick="openFlipNote(this)">
            <div class="face front"><img src="images/us.jpg" alt="mem5"></div>
            <div class="face back">Your first birthday together with me ‚Äî best day ever.</div>
          </div>
        </div>

        
        <div class="flip" data-note="Moment before we got out to explore the mall, saras parlour in jaipur.">
          <div class="flip-inner" onclick="openFlipNote(this)">
            <div class="face front"><img src="images/us6.jpg" alt="mem6"></div>
            <div class="face back">Moment before we got out to explore the mall, saras parlour in jaipur.</div>
          </div>
        </div>

        <div class="flip" data-note=" Our picture that looks like we are newly married , Hehe.">
          <div class="flip-inner" onclick="openFlipNote(this)">
            <div class="face front"><img src="images/us12.jpg" alt="mem7"></div>
            <div class="face back">Our picture that looks like we are newly married , Hehe.</div>
          </div>
        </div>

        <div class="flip" data-note="Our lovely moment filled with so much excitement and love">
          <div class="flip-inner" onclick="openFlipNote(this)">
            <div class="face front"><img src="images/us2.jpg" alt="mem8"></div>
            <div class="face back">Our lovely moment filled with so much excitement and love. Our Mirror selfies </div>
          </div>
        </div>

        <div class="flip" data-note="All the small cute moments , i miss them an i miss you..">
          <div class="flip-inner" onclick="openFlipNote(this)">
            <div class="face front"><img src="images/us9.jpg" alt="mem9"></div>
            <div class="face back">All the small cute moments , i miss them and i miss you.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- LOVE LETTER PARChMENT -->
    <section class="section">
      <h3>A Letter Just For You</h3>
      <div style="text-align:left; max-width:760px; margin:0 auto;">
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="primary" onclick="openLetter()">Open the Scroll üíå</button>
          <button class="secondary" onclick="downloadNote()">Download this Letter üì•</button>
        </div>
      </div>

      <article id="parch" class="parchment" aria-hidden="true">
        <strong style="display:block; margin-bottom:10px; font-size:18px; color:#7a344a;">My dearest,</strong>
        <p>
          If I could fold the world into a small paper note and hand it to you, I would ‚Äî because every fold would keep a memory of you.  
          You are the warm quiet in my mornings, the soft laugh in my evenings, and the place where I go to rest. You are only Solace.
          Yours arms are my favourite place to hide from the world, your smile makes my heart flutter , your kiss give me butterflies.
          My heart belongs to you and yours was already mine from the start, You are my future husband, My Dumbo , My mi amorb , My love.
          I love you so much and this i love you can't even express half of the love that i do in real lif, You are my Heart.
          I will always cherish you forever & i will be with you forever in sicknes and in health until death do us apart.
          Even death won't do us apart you know because we will live together as ghosts too, Hehe.  Happy Birthday my love üíó 

        </p>
        <p>
          I wrote this to remind you: you are seen, you are treasured, and you are loved more than the quiet poetry of this page can hold.
        </p>
        <p style="margin-top:18px;">Always and forever ‚Äî<br><strong style="color:#a23d60;">Yours only yours Duffer üíó</strong></p>
      </article>
    </section>

    <footer>
      <div style="font-size:13px;color:var(--muted);">Made with lots of love ‚Ä¢ Open on 8th Nov for a tiny surprise ‚ú®</div>
    </footer>
  </div>

  <!-- tiny decorative hearts -->
  <div class="tiny-hearts" aria-hidden="true">
    <div>üíó</div>
    <div>‚ú®</div>
    <div>üå∏</div>
  </div>

  <!-- secret overlay -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="secret">
      <button class="closeX" onclick="closeSecret()">‚úï</button>
      <h2>Little Secret Surprise</h2>
      <p>There‚Äôs a tiny memory-box below ‚Äî open any card to see a cute note. You can also press the ‚ô• button to shower hearts and confetti.</p>

      <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:12px;">
        <button class="primary" onclick="specialMoment()">Shower Hearts & Confetti ‚ú®</button>
        <button class="secondary" onclick="openLetter()">Open Love Letter Scroll</button>
      </div>

      <hr style="margin:18px 0; border:none; border-top:1px solid rgba(200,150,170,0.08)">

      <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px;">
        <!-- small secret mini-cards -->
        <div style="padding:12px; border-radius:12px; background:linear-gradient(180deg,#fff,#fff6f8); box-shadow:var(--card-shadow); text-align:left;">
          <strong>Remember:</strong>
          <p style="margin:8px 0 0; color:var(--muted)">The first time you called me My Baccha and I smiled for hours.</p>
        </div>
        <div style="padding:12px; border-radius:12px; background:linear-gradient(180deg,#fff,#fff6f8); box-shadow:var(--card-shadow); text-align:left;">
          <strong>Promise</strong>
          <p style="margin:8px 0 0; color:var(--muted)">I'll be your muse always and we are gonna be the endgame.</p>
        </div>
        <div style="padding:12px; border-radius:12px; background:linear-gradient(180deg,#fff,#fff6f8); box-shadow:var(--card-shadow); text-align:left;">
          <strong>Wish</strong>
          <p style="margin:8px 0 0; color:var(--muted)">One day ‚Äî we will be together forever and will live the most amazing life.</p>
        </div>
      </div>
    </div>
  </div>

<script>
  /* ========== Slideshow logic ========== */
  const slides = [
    "images/him1.jpg",
    "images/him10.jpg",
    "images/him.jpg",
    "images/him2.jpg",
    "images/him4.jpg",
    "images/him5.jpg",
    "images/him6.jpg",
    "images/him7.jpg",
    "images/him8.jpg",
    "images/him9.jpg"

  ];
  let sIndex = 0;
const mainSlide = document.getElementById('mainSlide');
const dotsContainer = document.getElementById('dots');

function renderDots(){
  dotsContainer.innerHTML = "";
  slides.forEach((_, i) => {
    const d = document.createElement("div");
    d.classList.add("dot");
    if(i === 0) d.classList.add("active");
    d.addEventListener("click", () => {
      sIndex = i;
      showSlide(sIndex);
    });
    dotsContainer.appendChild(d);
  });
}

function showSlide(i){
  mainSlide.src = slides[i];
  [...dotsContainer.children].forEach((d, idx) => {
    d.classList.toggle("active", idx === i);
  });
}

renderDots();
showSlide(sIndex);

// auto slide
setInterval(() => {
  sIndex = (sIndex + 1) % slides.length;
  showSlide(sIndex);
}, 2500); // you can change speed here
  /* ========== Special Surprise: hearts + confetti + parchment reveal ========== */
  function specialMoment(){
    // reveal parchment gently
    const parch = document.getElementById('parch');
    if(!parch.classList.contains('open')) parch.classList.add('open');
    // hearts + confetti
    burstHearts(24);
    burstConfetti(26);
    // small heartbeat for title
    document.querySelector('.logo').animate([{transform:'scale(1)'},{transform:'scale(1.08)'},{transform:'scale(1)'}], { duration:900 });
  }

  function burstHearts(count=20){
    for(let i=0;i<count;i++){
      const h = document.createElement('div');
      h.textContent = ['üíó','üíû','üå∏'][Math.floor(Math.random()*3)];
      h.style.position='fixed';
      h.style.left = (10 + Math.random()*80) + '%';
      h.style.bottom = '-10px';
      h.style.fontSize = (14 + Math.random()*28) + 'px';
      h.style.pointerEvents='none';
      h.style.zIndex=9999;
      h.style.transition = `transform ${3.2 + Math.random()*1.2}s cubic-bezier(.2,.9,.2,1), opacity 2.8s ease`;
      document.body.appendChild(h);
      // trigger movement
      setTimeout(()=> {
        h.style.transform = `translateY(-${200 + Math.random()*520}px) translateX(${(Math.random()-0.5)*160}px) rotate(${Math.random()*360}deg)`;
        h.style.opacity = '0';
      }, 40 + i*20);
      // remove after anim
      setTimeout(()=> h.remove(), 4200);
    }
  }

  function burstConfetti(n=20){
    for(let i=0;i<n;i++){
      const c = document.createElement('div');
      c.textContent = ['‚ú®','‚ù£Ô∏è','üåü','üå∏'][Math.floor(Math.random()*4)];
      c.style.position='fixed';
      c.style.left = 50 + (Math.random()-0.5)*40 + '%';
      c.style.top = 40 + (Math.random()-0.5)*20 + '%';
      c.style.fontSize = (10 + Math.random()*24) + 'px';
      c.style.opacity = '1';
      c.style.pointerEvents='none';
      c.style.transform = 'translate(-50%,-50%) scale(1)';
      c.style.zIndex = 9998;
      document.body.appendChild(c);
      // animate outward
      setTimeout(()=> {
        c.style.transition = `transform ${1.2 + Math.random()*0.8}s cubic-bezier(.2,.9,.2,1), opacity 1.4s ease`;
        c.style.transform = `translate(${(Math.random()-0.5)*420}px, ${-(80 + Math.random()*480)}px) rotate(${Math.random()*540}deg) scale(${0.6 + Math.random()*1.0})`;
        c.style.opacity = '0';
      }, 30 + i*10);
      setTimeout(()=> c.remove(), 1800 + Math.random()*800);
    }
  }

  /* ========== Letter open / download ========== */
  function openLetter(){
    const p=document.getElementById('parch');
    if(!p.classList.contains('open')) p.classList.add('open');
    // smooth scroll to it
    setTimeout(()=> p.scrollIntoView({behavior:'smooth', block:'center'}), 120);
  }

  function downloadNote(){
    // make a downloadable text file of the letter
    const text = `My dearest,\n\nIf I could fold the world into a small paper note and hand it to you, I would ‚Äî because every fold would keep a memory of you.\n\nYou are the warm quiet in my mornings, the soft laugh in my evenings, and the place where I go to rest.\n\nAlways and forever ‚Äî\nme üíó`;
    const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'love-letter-for-you.txt';
    document.body.appendChild(a); a.click();
    a.remove(); URL.revokeObjectURL(url);
  }

  /* ========== Secret overlay ========== */
  function openSecret(){
    const ov=document.getElementById('overlay');
    ov.classList.add('show');
    ov.setAttribute('aria-hidden','false');
  }
  function closeSecret(){
    const ov=document.getElementById('overlay');
    ov.classList.remove('show');
    ov.setAttribute('aria-hidden','true');
  }

  /* ========== Flip card note open (optional) ========== */
  function openFlipNote(el){
    // if tapped/clicked on small screens, still flip
    // we will toggle rotated state
    const inner = el.querySelector('.flip-inner');
    // manual toggle rotation to keep accessibility on tap
    if(inner.style.transform && inner.style.transform.includes('rotateY(180deg)')){
      inner.style.transform = '';
    } else {
      inner.style.transform = 'rotateY(180deg)';
      // auto-reverse after 3.6s so it doesn't stay flipped
      setTimeout(()=> inner.style.transform = '', 3600);
    }
  }

  /* ========== helpers: navigation ========== */
  function goHome(){ window.scrollTo({top:0, behavior:'smooth'}); }
  function scrollToSection(id){ document.getElementById(id).scrollIntoView({behavior:'smooth', block:'center'}); }

  // accessibility: close secret with ESC
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') { closeSecret(); closeGift(); closeVoiceModal(); } });

  // make images replaceable: NOTE to you -> replace the picsum links with local filenames like "photo1.jpg"


  /* ---------------------- NEW FEATURE SCRIPTS ---------------------- */

  // 1) Opening overlay controls
  function enterSite(){
    const o = document.getElementById('openingOverlay');
    if(!o) return;
    o.style.transition = 'opacity .45s';
    o.style.opacity = '0';
    setTimeout(()=> o.remove(), 480);
    // small welcome pulse
    const logo = document.querySelector('.logo');
    if(logo) logo.animate([{transform:'scale(.98)'},{transform:'scale(1.06)'},{transform:'scale(1)'}], {duration:700});
  }

  // 2) Voice message system (TTS + optional recorded audio)
  // Voice script (your sweet tone + little giggle)
  const voiceScript = `Hi Gaurav‚Ä¶ it‚Äôs me, Khushi. 
  I just wanted to say this‚Ä¶ thank you for being you. 
  From our first talk on 23rd October to us becoming us on 16th April 2023, 
  every little moment has felt like home with you. 
  I know I call you Dumbo‚Ä¶ but you‚Äôre my Dumbo. 
  My favourite person. My safe place. 
  And today, on your birthday‚Ä¶ I just hope you feel loved the way you make me feel, every day. 
  Happy Birthday, love. Hehe.`;

  // SpeechSynthesis state
  const synth = window.speechSynthesis;
  let ttsUtterance = null;
  let ttsPlaying = false;

  // Elements
  const voiceModal = () => document.getElementById('voiceModal');
  const recordedAudio = () => document.getElementById('recordedAudio');

  function openVoiceModal(){
    const m = voiceModal();
    if(!m) return;
    // toggle
    if(m.style.display === 'block' || m.style.display === 'flex'){
      m.style.display = 'none';
      m.setAttribute('aria-hidden','true');
      stopEverything();
    } else {
      m.style.display = 'block';
      m.setAttribute('aria-hidden','false');
    }
  }

  function closeVoiceModal(){
    const m = voiceModal();
    if(!m) return;
    m.style.display = 'none';
    m.setAttribute('aria-hidden','true');
    stopEverything();
  }

  // stop both TTS and recorded audio
  function stopEverything(){
    stopTTS();
    const ra = recordedAudio();
    if(ra && !ra.paused){
      ra.pause();
      ra.currentTime = 0;
    }
  }

  function playTTS(){
    // stop recorded audio if playing
    const ra = recordedAudio();
    if(ra && !ra.paused) { ra.pause(); ra.currentTime = 0; }

    if(synth.speaking){
      // restart
      synth.cancel();
    }

    // Create utterance
    ttsUtterance = new SpeechSynthesisUtterance(voiceScript);
    // prefer a female / warm voice if available
    const voices = synth.getVoices() || [];
    // try to pick a friendly voice (searching for female / english ones)
    let chosen = voices.find(v => /female|woman|girl|zira|samantha|alloy/i.test(v.name)) ||
                 voices.find(v => /google uk english female|en-GB|en-US/i.test(v.name)) ||
                 voices.find(v => /en-US|en-GB|English/i.test(v.lang)) ||
                 voices[0];
    if(chosen) ttsUtterance.voice = chosen;

    ttsUtterance.rate = 1.0;
    ttsUtterance.pitch = 1.05;
    ttsUtterance.volume = 1.0;

    ttsUtterance.onstart = () => { ttsPlaying = true; };
    ttsUtterance.onend = () => { ttsPlaying = false; };
    ttsUtterance.onerror = () => { ttsPlaying = false; };

    synth.speak(ttsUtterance);
  }

  function stopTTS(){
    if(synth && synth.speaking){
      synth.cancel();
      ttsPlaying = false;
    }
  }

  // Also make recorded audio pause TTS when started
  document.addEventListener('play', function(e){
    if(e.target && e.target.id === 'recordedAudio'){
      // stop TTS if it's playing
      if(synth && synth.speaking) synth.cancel();
    }
  }, true);

  // Ensure voices are loaded (some browsers load asynchronously)
  if(typeof speechSynthesis !== 'undefined'){
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = function(){ /* loaded */ };
    }
  }

  function downloadScript(){
    const blob = new Blob([voiceScript], {type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'voice-script-for-gaurav.txt';
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  // 3) Gift reveal with confetti
  function openGift(){
    document.getElementById('giftReveal').style.display = 'flex';
    document.getElementById('giftReveal').setAttribute('aria-hidden','false');
    launchConfetti(30);
  }
  function closeGift(){
    document.getElementById('giftReveal').style.display = 'none';
    document.getElementById('giftReveal').setAttribute('aria-hidden','true');
  }
  function finalReveal(){
    document.getElementById('finalMessage').style.display = 'block';
    launchConfetti(60);
  }

  function launchConfetti(n=30){
    for(let i=0;i<n;i++){
      const el = document.createElement('div');
      el.className = 'confetti-piece';
      el.style.left = (50 + (Math.random()-0.5)*60) + 'vw';
      el.style.top = (30 + (Math.random()-0.5)*60) + 'vh';
      el.textContent = ['‚ú®','üéâ','üíó','üå∏'][Math.floor(Math.random()*4)];
      el.style.fontSize = (12 + Math.random()*30) + 'px';
      document.body.appendChild(el);
      el.animate([{transform:'translateY(0) scale(1) rotate(0deg)', opacity:1},
                  {transform:`translateY(${200 + Math.random()*600}px) translateX(${(Math.random()-0.5)*400}px) rotate(${Math.random()*720}deg)`, opacity:0}],
                  {duration:1200 + Math.random()*900, easing:'cubic-bezier(.2,.9,.2,1)'});
      setTimeout(()=> el.remove(), 2000 + Math.random()*1200);
    }
  }

  // Helper: allow Enter to dismiss opening overlay & Esc to close voice modal
  document.addEventListener('keydown', (e)=> {
    if(e.key === 'Enter'){
      const o = document.getElementById('openingOverlay');
      if(o) enterSite();
    }
    if(e.key === 'Escape'){
      // close voice/secret/gift
      closeVoiceModal(); closeSecret(); closeGift();
    }
  });

</script>
</body>
</html>
